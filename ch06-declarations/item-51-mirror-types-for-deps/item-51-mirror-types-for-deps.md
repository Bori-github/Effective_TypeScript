# 의존성 분리를 위해 미러 타입 사용하기 | Effective TypeScript

## 라이브러리 만들기

CSV 파일을 파싱하는 라이브러리를 만들어봅시다.

- 매개변수로 CSV 파일의 내용(content)를 받습니다.
- NodeJS 사용자를 위해 매개변수에 `Beffer` 타입을 허용하려고 합니다.

![image](https://github.com/Bori-github/Effective_TypeScript/assets/85009583/d4658e4c-9f63-427c-bd38-67e437e9c88c)

`Beffer` 타입의 정의는 NodeJS 타입 선언(`@type/node`)을 설치해서 얻을 수 있습니다.
라이브러리를 공개할 경우 타입 선언도 포함하게 됩니다.
CSV 파일 파싱 라이브러리는 타입선언이 `@type/node`에 의존하기 때문에 `@type/node`를 devDependencies에 포함해야 합니다.

이때 다음과 같은 사용자들을 고려해야합니다.

- 타입스크립트 비사용자
  - 자바스크립트 개발자의 경우 `@type`과 무관합니다.
- NodeJS 비사용자
  - Buffer는 NodeJS 개발자만 필요합니다.

두 그룹의 사용자들은 각자 사용하지 않는 모듈이 포함되어 있습니다.
따라서, `@type/node`는 NodeJS와 타입스크립트를 동시에 사용하는 개발자만 관련됩니다.

## 구조적 타이핑 사용하기

각자 필요한 모듈만 사용할 수 있도록 **구조적 타이핑**을 적용하여 필요한 메서드와 속성만 별도로 작성할 수 있습니다.

> #### 구조적 타이핑
>
> - 집합과 관계가 있는 타입 시스템으로 명목적 타이핑과 같은 명확한 상속 관계(A-B)를 지향하기보다는 집합을 포함한다는 개념을 지향
> - 같은 속성의 타입이 있는지를 체크하여 호환
> - 중복되는 범위가 있다면 재사용할 수 있지만 의도하지 않게 동일한 타입을 가지는 경우 동일한 유형으로 간주될 수 있다.

![image](https://github.com/Bori-github/Effective_TypeScript/assets/85009583/56cba6cb-d6c3-4fa7-a814-60777f436d3d)

`CsvBuffer` 인터페이스를 사용하여 실제로 필요한 부분만을 명시했습니다.
또한 해당 타입은 `Buffer`와 호환이 됩니다. 따라서, NodeJS 프로젝트에서 `parseCSV`를 호출할 수 있습니다.

이와 같이 필요한 선언부만 추출하여 작성 중인 라이브러리에 넣는 것을 **미러링(mirroring)** 이라고 합니다.
다른 라이브러리의 타입에만 의존하는 경우, 미러링을 적용할 수 있습니다.

하지만 다른 라이브러리의 타입 선언의 대부분을 추출해야한다면, 미러링 대신 명시적으로 `@type` 의존성을 추가하는 것이 좋습니다.

## 마무리

- 필수가 아닌 의존성을 분리할 때 구조적 타이핑을 사용할 수 있습니다.
- 공개 라이브러리를 사용하는 여러 그룹의 사용자가 각자 사용하지 않는 모듈의 의존성을 가지지 않게 해야합니다.

> #### 참고
>
> - [덕 타이핑과 구조적 타이핑](https://vallista.kr/%EB%8D%95-%ED%83%80%EC%9D%B4%ED%95%91%EA%B3%BC-%EA%B5%AC%EC%A1%B0%EC%A0%81-%ED%83%80%EC%9D%B4%ED%95%91/)
